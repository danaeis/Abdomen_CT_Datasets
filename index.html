<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abdomen CT Studies Review - Overview</title>
    <link href="https://fonts.googleapis.com/css2?family=Spectral:wght@300;400;600;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>Abdomen CT Studies Review Dataset</h1>
        <p class="subtitle">Comprehensive Analysis of Public Abdomen CT Datasets</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html" class="active">Overview</a></li>
            <li><a href="datasets.html">Dataset Features</a></li>
            <li><a href="organs.html">Organ Analysis</a></li>
            <li><a href="bias.html">Bias Evaluation</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalDatasets">-</div>
                <div class="stat-label">Total Datasets</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCTStudies">-</div>
                <div class="stat-label">Total CT Studies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="publicCTStudies">-</div>
                <div class="stat-label">Public CT Studies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgCitations">-</div>
                <div class="stat-label">Avg Citations</div>
            </div>
        </div>

        <!-- Year Chart -->
        <div class="card">
            <h2>Dataset Publications by Year</h2>
            <div class="chart-container">
                <canvas id="yearChart"></canvas>
            </div>
        </div>

        <!-- Organs Chart -->
        <div class="card">
            <h2>Top Annotated Organs</h2>
            <div class="chart-container">
                <canvas id="organsChart"></canvas>
            </div>
        </div>
    </div>

    <footer>
        <p>Abdomen CT Studies Review Dataset Visualization</p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.7;">Interactive data exploration for medical imaging research</p>
    </footer>

    <script>
        // Load data and create charts
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                const datasets = data.datasets || [];
                const total = data.total || {};
                
                // Update stats
                document.getElementById('totalDatasets').textContent = datasets.length;
                document.getElementById('totalCTStudies').textContent = 
                    (total['number of CT studies'] || 0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                document.getElementById('publicCTStudies').textContent = 
                    (total['number of public CT studies'] || 0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                
                const avgCitations = Math.round(
                    datasets.reduce((sum, d) => sum + (parseInt(d.Citations) || 0), 0) / datasets.length
                );
                document.getElementById('avgCitations').textContent = avgCitations;

                // Year distribution chart
                const yearCounts = {};
                datasets.forEach(d => {
                    const year = d['year of publication'];
                    if (year) yearCounts[year] = (yearCounts[year] || 0) + 1;
                });

                new Chart(document.getElementById('yearChart'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(yearCounts).sort(),
                        datasets: [{
                            label: 'Datasets Published',
                            data: Object.keys(yearCounts).sort().map(y => yearCounts[y]),
                            backgroundColor: '#2c5f7e',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } }
                    }
                });

                // Organs chart
                const organCounts = {};
                datasets.forEach(d => {
                    const organs = String(d['Annotated Organ Name'] || '').split(',');
                    organs.forEach(organ => {
                        const o = organ.trim();
                        if (o && o !== '-') organCounts[o] = (organCounts[o] || 0) + 1;
                    });
                });

                const topOrgans = Object.entries(organCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);

                new Chart(document.getElementById('organsChart'), {
                    type: 'bar',
                    data: {
                        labels: topOrgans.map(o => o[0]),
                        datasets: [{
                            label: 'Frequency',
                            data: topOrgans.map(o => o[1]),
                            backgroundColor: '#d4af37',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: { legend: { display: false } }
                    }
                });
            })
            .catch(error => console.error('Error loading data:', error));
    </script>
</body>
</html>
